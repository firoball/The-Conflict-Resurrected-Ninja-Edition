#define PRAGMA_PATH "bmaps"
#include <acknex.h>
#include <windows.h>
#include <mtlfx.c>
#include <default.c>
#define set2(o,f) o.flags2|=(f)
#define reset2(o,f) o.flags2&=~(f)
#define T(x) ((x)*time_step)
var i,b=42,o=42,j=66,t,s,f,c,n=42;
VECTOR v;
ENTITY* d[79];
VIEW* w[2];
void mw(PARTICLE* p){p.vel_z-=T(0.1);
}void pa(PARTICLE* p){p.alpha=maxv(p.alpha-T(2),0);
}void ee(PARTICLE* p){if((p.event=pa)&&(set(p,TRANSLUCENT|BRIGHT|STREAK|MOVE)))p.alpha=25+random(25)+0*(vec_add(p.vel_x,vec_normalize(vector(random(2)-1,random(2)-1,random(20)),random(50)))).x*(vec_set(p.blue,vector(20,110,150))).x;
}void pe(PARTICLE* p){if((p.event=mw)&&(set(p,MOVE|STREAK))&&(p.lifespan=60)&&(p.size=2))p.alpha=45+0*(vec_set(p.blue,vector(180,80,62))).x*(vec_set(p.vel_x,vector(-1+random(2),-1+random(2),3.5+random(1.5)))).x;
}void es(PARTICLE* p){if(!(p.event=NULL)&&(set(p,STREAK|MOVE|BRIGHT))&&(p.size=4)&&(p.vel_z*=8+random(4)))p.alpha=20+random(10)+0*(vec_set(p.blue,vector(255,255,255))).x*(vec_add(p.x,vector(random(220)-110,random(1400)-700,0))).x;
}void ei(PARTICLE* p){if((p.event=pa)&&(set(p,STREAK|BRIGHT))&&(p.size=2))p.alpha=25+random(25)+0*(vec_add(p.vel_x,vec_normalize(vector(random(2)-1,random(2)-1,random(2)-1),random(150)))).x*(vec_set(p.blue,vector(255,255,255))).x;
}void fa(){wait(1);
if((w[0].alpha=100)&&(w[0].fog_end=w[1].fog_end=1100)&&((fog_color=d[3].skill[5])>-1)&&(t=9))while(d[++t]!=NULL)if(d[t].alpha=d[t].skill[0])set2(d[t],SHOW);
while(f<4){while(c<d[3].skill[f+1])wait(1);
//while(f<4){while(c<10+10*f)wait(1);
t=9+5*f++;
while(d[++t]!=NULL)set2(d[t],SHOW);
if((set(w[f%2],TRANSLUCENT))&&(set(w[1-f%2],SHOW)))w[1-f%2].fog_start=1000;
while(w[f%2].alpha>0){w[f%2].alpha=maxv(0,w[f%2].alpha-T(2))+0*(fog_color=d[3].skill[f+4+(w[f%2].alpha<=50)])*(w[f%2].fog_start=w[1-f%2].fog_start=1000-abs(w[f%2].alpha-50)*16)*(t=9+5*f);
while(d[++t]!=NULL)d[t].alpha=minv(d[t].skill[0],d[t].alpha+T(2));
t=4+5*f;
while(d[++t]!=NULL)d[t].alpha=maxv(0,d[t].alpha-T(2));
wait(1);
}t=4+5*f;
while(d[++t]!=NULL)reset2(d[t],SHOW);
if(reset(w[f%2],SHOW|TRANSLUCENT))w[f%2].alpha=100+0*layer_sort(w[f%2],-1)*(s+=1+0*layer_sort(w[1-f%2],1));
}while(c<252)wait(1);
//}while(c<60)wait(1);
if(set(w[1],TRANSLUCENT))w[1].alpha=100;
while(w[1].alpha>0)w[1].alpha-=T(2)+0*wait(1);
if(reset(w[1],SHOW))wait(-2.5);
sys_exit("");
}void sm(i){while(o<b+i){set2(d[++o],SHOW);
while(d[o].alpha<d[o].skill[1])d[o].alpha=minv(d[o].alpha+T(2),d[o].skill[1])+0*wait(1);
wait(d[o].skill[2]);
while(d[o].alpha>0){d[o].alpha=maxv(d[o].alpha-T(1),0)+0*wait(1);
if(d[o].skill[0]==4)d[o].scale_x+=T(0.1)+0*(d[o].x+=T(15));
if(d[o].skill[0]==1)d[o].x-=T(10);
if(d[o].skill[0]==2)d[o].x+=T(10);
if(d[o].skill[0]==3)d[o].scale_x-=T(0.01);
}if(!reset2(d[o],SHOW))wait(-1);
}b=o;
}void sh(){if((d[12].alpha=80)&&(d[13].alpha=70)&&(set2(d[12],SHOW)))wait(-2);
while(d[12].alpha>0)d[12].alpha=maxv(0,d[12].alpha-T(3))+0*(d[12].scale_x+=T(0.05))*(d[12].scale_y-=T(0.02))*wait(1);
if(!reset2(d[12],SHOW))wait(-1);
set2(d[13],SHOW);
while(d[13].skill[11]<32){wait(-0.125);
d[13].skill[11]+=1+0*(d[13].scale_x=0.25+random(0.5))*(d[13].scale_y=0.25+random(0.5));
}d[13].scale_x=d[13].scale_y=0.5;
wait(-0.5);
while(d[13].alpha>0)d[13].alpha=maxv(0,d[13].alpha-T(6))+0*wait(1);
if(!reset2(d[13],SHOW))wait(-2);
sm(8);
while(c<125)wait(1);
sm(6);
while(c<153)wait(1);
if(me=d[j])you=d[++j];
if((set2(me,SHOW))&&(my.roll=-45)&&(my.alpha=you.alpha=100))set2(you,SHOW);
while(j<80){if(my.skill[0]==0){d[66].skill[1]=my.roll;
while(my.alpha>0)you.alpha=my.alpha=maxv(0,my.alpha-T(4))+0*(you.roll=my.roll+=T(0.5))*wait(1);
if(!reset2(me,SHOW))reset2(you,SHOW);
wait(-1);
if(me=d[++j])you=d[++j];
if((you.alpha=my.alpha=100)&&(my.roll=d[66].skill[1]+60)&&(set2(me,SHOW)))set2(you,SHOW);
}vec_set(v,vec_rotate(vector(0,0,(my.skill[0]=maxv(0,my.skill[0]-T(25)))),my.pan));
vec_set(my.x,vector(my.x,-v.y,v.z));
you.roll=my.roll+0*(vec_set(you.x,vector(you.x,-my.y,-my.z))).x*wait(1);
}sm(4);	
while(s<4)wait(1);
sm(5);
}void main(){RECT r;
if((t=-1)&&(d3d_antialias=9)&&(tex_share=1)&&(fps_max=100)&&(GetWindowRect(GetDesktopWindow(),&r)!=0)&&(w[0]=view_create(-1))&&(w[1]=camera))/*video_set(r.right,r.bottom,32,1);*/video_set(1024,768,32,0);
while(++t<2){w[t].size_x=minv(screen_size.x,screen_size.y*2);
w[t].pos_x=(screen_size.x-w[t].size_x)/2;
w[t].size_y=w[t].size_x/2;
w[t].pos_y=(screen_size.y-w[t].size_y)/2;
}if(!(w[1].alpha=0*wait(1)))set(w[1],TRANSLUCENT);
if(level_load("hh_demo.wmb"))fa();
while(1)c+=1+0*wait(-1);
}action sd(){d[my.skill[0]]=me;
}action sl(){if(d[my.skill[0]]=ent_createlayer(str_for_entfile(NULL,me),0,9))reset2(d[my.skill[0]],SHOW);
d[my.skill[0]].alpha=0*(vec_set(d[my.skill[0]].x,my.skill[1])).x*(vec_set(d[my.skill[0]].scale_x,my.skill[4])).x*(vec_set(d[my.skill[0]].skill[0],my.skill[7])).x;
set(d[my.skill[0]],TRANSLUCENT|BRIGHT*(my.skill[10]!=0));
}action rot_outerpipe(){while(f<3)wait(1);
if(you=my.parent)d[9]=you.parent;
while(s<4){if((d[9].pan-=T(10))&&(my.pan+=T(9))&&(you.pan+=T(5)))my.ambient=70*abs(cosv(total_ticks*30))+0*(you.ambient=70*abs(sinv(total_ticks*30)));
if(f<4&&s>2)d[25].alpha=d[25].skill[0]-20*abs(sinv(total_ticks*30));
vec_set(my.skill[0],vec_set(v,vec_scale(vector(cosv(you.pan),sinv(you.pan),0),50+abs(50*cosv(total_ticks*2)))));
w[0].z=you.z-abs(450*cosv(total_ticks*6))+0*(vec_set(w[0].x,vec_add(my.skill[0],you.x))).x;
my.z=0*(vec_set(my.x,vec_add(my.skill[0],v))).x*(vec_set(w[0].pan,vector(w[0].pan-T(7),-90+35*sinv(total_ticks*5),0))).x*wait(1);
}}action walk_path(){while((f<2)&&(you=my.parent))wait(1);
while(s<3){my.skill[0]+=T(30)+0*path_spline(me,w[1].x,my.skill[0]);
w[1].roll=40*cosv(total_ticks*6)+0*vec_to_angle(w[1].pan,vec_sub(vector(you.skill[5],you.skill[6],150*sinv(total_ticks*8)),w[1].x));
you.z=you.skill[4]+10*cosv(total_ticks*3)*T(1)+0*(you.skill[9]=cycle(you.skill[9]+T(2),0,100)+0*ent_animate(me,"Frame",you.skill[9],ANM_CYCLE));
if((you.skill[8]+=T(1))>48)you.skill[8]-=48+0*effect(ee,300,you.skill[5],vec_scale(normal,10));
t=20+0*(vec_set(d[20].x,vector(d[20].x,-260+5*sinv(total_ticks*5),5*cosv(total_ticks*4)))).x;
while(++t<24){d[t].y=230+40*sinv(total_ticks*10+120*(t-21))+0*(d[t].z=3*sinv(total_ticks*40+90*(t-21)));
if(s==2&&f<3)if((d[t].alpha=maxv(0,d[t].alpha-T(10)))==0)if((d[t].skill[1]+=T(1))>4)d[t].alpha=90+0*(d[t].scale_y*=-1)*(d[t].skill[1]-=4);
}d[n].alpha=maxv(0,d[n].alpha-T(16));
if(d[n].alpha==0){if(d[n].alpha=90)reset2(d[n],SHOW);
n=cycle(n+1,35,43);
if(set2(d[n],SHOW))vec_set(d[n].x,vector(300,-40+(random(140)-70),(random(100)-50)));
}wait(1);
}reset2(d[n],SHOW);
}action set_sprite(){if(my.frame=my.skill[1])while(s<3)if(wait(1)&&(my.frame=minv(my.frame+T(0.8),57))>=57)my.frame=0*wait(-2);
}action set_heaven(){while(f<1)wait(1);
while(s<2){if((my.skill[0]+=T(1))>5)my.skill[0]-=5+0*effect(pe,15,vector(my.x,my.y,my.z+30),nullvector);
if(s>0&&f<2)d[18].alpha=d[18].skill[0]+5*sinv(total_ticks*4)+0*(d[17].alpha=d[18].skill[0]+5*cosv(total_ticks*6));
d[18].y=300*sinv(total_ticks)+0*(d[17].y=300*cosv(total_ticks*1.5))*(vec_set(w[0].pan,vector(w[0].pan+T(3)*(0.2+abs(sinv(total_ticks))),-15-5*sinv(total_ticks*2),15*cosv(total_ticks*6)))).x*(vec_add(vec_rotate(vec_set(w[0].x,vector(-400-250*sinv(total_ticks*5),0,70)),w[0].pan),my.x)).x;
if((d[15].skill[2]+=T(1))>96)d[16].y-=d[16].skill[1]*T(1)+0*(d[15].y=d[16].y*-1);
if(abs(d[16].y)>340&&(t=14)){while(++t<17)d[t].x=300+0*(vec_set(d[t].x,vector(0,clamp(d[t].y,-340,340),d[t].z*-1))).x+0*(d[t].skill[1]*=-1+0*(vec_scale(d[t].scale_x,-1)).x);
d[15].skill[2]%=96;
}wait(1);
}}action set_intro(){if(0*wait(snd_play(snd_create("nb_clysm.ogg"),100,0)!=0)==0)sh();	
while(s<5){if(!f)if((w[1].alpha=minv(100,w[1].alpha+T(1)))==100)reset(w[1],TRANSLUCENT);
if(s==0||f==4)my.v+=T(18)*((s==0)-(f==4))+0*(vec_set(w[1].pan,vector(50*(sinv(2*total_ticks))*(s==0)+(w[1].pan+T(3))*(f==4),-90+15*cosv(3*total_ticks),0))).x*(vec_set(w[1].x,vector(70*sinv(3*total_ticks),2688+(70+90*(f==4))*cosv(3*total_ticks),592))).x;
if((s==0||s==4)&&c>9&&(my.skill[3]+=T(1))>3)my.skill[3]%=3+0*effect(ei,10,my.skill[0],nullvector)*effect(es,6,my.skill[s],my.skill[7+s]);
wait(1);
}}//always comment your code! -ninjaball